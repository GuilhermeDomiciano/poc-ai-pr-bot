# POC AI PR Bot

A proof-of-concept bot that reads a GitHub Issue, asks a CrewAI workflow to generate code changes, applies those changes in a cloned repository, commits/pushes a branch, and opens a Pull Request.

## What It Does

1. Reads issue data from GitHub (`ISSUE_NUMBER`).
2. Clones the target repository into `/work/repo`.
3. Runs a CrewAI flow (`dev`, `qa`, `git` agents).
4. Expects a final JSON payload with:
   - `files` (path -> full file content)
   - `branch`
   - `commit`
   - `pr_title`
   - `pr_body`
5. Writes files, creates a new branch, commits, pushes, and tries to create a PR.

## Project Structure

- `main.py`: orchestration pipeline (clone, Crew run, git actions, PR creation).
- `crew_flow.py`: CrewAI agents/tasks and output contract.
- `github_client.py`: minimal GitHub API client (`get_issue`, `create_pr`).
- `requirements.txt`: pinned dependencies.
- `Dockerfile` / `docker-compose.yml`: containerized execution.
- `.env.example`: required environment variables.

## Requirements

- Python 3.10-3.13 (CrewAI pinned version is not compatible with Python 3.14).
- Git installed.
- GitHub token with repository write + PR permissions.
- OpenAI API key.

## Setup

```bash
python -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
cp .env.example .env
```

Edit `.env`:

```env
OPENAI_API_KEY=...
GITHUB_TOKEN=...
GH_OWNER=your-org-or-user
GH_REPO=your-repo
ISSUE_NUMBER=1
GIT_AUTHOR_NAME=AI Bot
GIT_AUTHOR_EMAIL=ai-bot@example.com
# Optional:
# GH_BASE_BRANCH=main
```

## Run

```bash
python main.py
```

Or with Docker:

```bash
docker compose up --build
```

## Expected Behavior

- Each successful run creates and pushes a branch (as generated by the Crew output).
- PR creation targets `main` by default, or `GH_BASE_BRANCH` if set.
- If the base branch does not exist on remote, the bot skips PR creation and exits cleanly after pushing.

## Notes

- This is a POC and currently has no committed automated tests.
- The bot writes **full file contents** from AI output, not diffs.
- Use a test repository first before running against production repos.
